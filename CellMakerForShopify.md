# FastLand CellMaker for Shopify

This is an app that helps companies insert rich content on Shopify product pages. Today it exists as a private app for a single customer. The plan is to soon make this a public app.

The app runs on AWS, using a dedicated EC2 server and the Aurora (MySQL) database. The code is on a GitHub private repository.


## Background
We are a SaaS company that offers automated publishing services. For more than 20 years, we have been automating composition of PDF catalogs for distributors and other B2B companies. We are now pivoting to automated publishing of content for ecommerce sites.

To begin, we are focusing on a single customer: Gempler's. They have been using our PDF solution for nearly two years. Now we are providing Gempler's with a way to insert content on their Shopify product detail pages (PDPs). Here is a example using one of our simplest templates. See the 6 images and captions, plus the horizontal image, below the description:
https://gemplers.com/products/gemplers-rust-converter-1-gal.

We are developing additional templates that will help tell product stories, explain benefits, list features and attributes, publish SKU tables, display parts and accessories, offer notes and instructions, document how-to's, make special offers, show banners, note certifications, present special offers and more.

Our approach to HTML publishing is derived from our approach to print publishing. That is, our publishing engine (called FastLand Publisher) builds discrete packages of content, which we refer to as "cells". For example, a simple cell might consist of a single image and a caption (such as one of the image/caption cells on the rust converter page mentioned above). More complex cells might contain dozens of data elements and/or images. Cells are in turn grouped into "cell sets". For example, the set of 6 image/caption cells, plus the single horizontal image, comprise a single cell set.

Cell sets are published using our web service called FastLand Publisher.

## Existing private Shopify app
The existing app has both backend and frontend functionality.

### Backend functionality
The app embeds HTML content generated by FastLand Publisher on Shopify product detail pages (PDPs). The content is contained within discrete blocks, which we call "cells". Cells are in turn grouped into "cell sets".


Here is a link to the content as it is published, before it is embedded into Shopify: https://fast-land.com/gemplers-development.myshopify.com/mstrtqpx1646.html. The content is inserted into a Shopify product page via a snippet. The app searches the FastLand database to see if there is content for that page handle. If the handle is found, it inserts the FastLand content at the snippet.

IMPORTANT NOTE: The app does not generate the HTML. The HTML and the accompanying css and image files are rendered by our publishing system (FastLand Publisher). This system runs on AWS EC2 servers and also caches the rendered files on EC2 servers. You do not need to know anything about how the publishing system works. It is a "black box" that supports the app.

The app has an API that is called by FastLand Publisher. Here is an example call:
```
{
  "store": "gemplers-development.myshopify.com",
  "destination": "a",
  "handles": ["gemplers-rust-converter-1-gal", "gemplers-rust-converter-kit-with-xl-gloves", "gemplers-rust-converter-kit-with-large-gloves", "gemplers-rust-converter-1-qt", "gemplers-sprayable-formula-rust-converter", "spray-on-rust-converter"],
  "tags": [],
  "collections": [],
  "vendors": [],
  "producttypes": [],
  "base_url": "https://fast-land.com/gemplers-development.myshopify.com",
  "html": "mstrtqpx1646.html",
  "styles": ["fastland.css", "fastland_fonts.css", "fastland_inline.css", "mstrtqpx1646.css"],
  "images": ["mstrtqpx1646_pg1_0.jpg", "mstrtqpx1646_pg1_1.jpg", "mstrtqpx1646_pg1_2.jpg", "mstrtqpx1646_pg1_3.jpg", "mstrtqpx1646_pg1_4.jpg", "mstrtqpx1646_pg1_5.jpg", "mstrtqpx1646_pg1_6.jpg", "mstrtqpx1646_pg1_6424_0_9564_3932.png", "mstrtqpx1646_pg1_6424_4028_9564_7744.png", "mstrtqpx1646_pg1_144_4028_3284_7960.png", "mstrtqpx1646_pg1_144_0_3284_3932.png", "mstrtqpx1646_pg1_144_7960_9576_10192.png", "mstrtqpx1646_pg1_3284_4028_6424_7960.png", "mstrtqpx1646_pg1.png", "mstrtqpx1646_pg1_3284_0_6424_3716.png"]
}
```
* ```store``` is the ```.myshopify.com``` URL
* ```destination``` refers to a particular snippet (e.g., ```{% include 'fastland-a' %}```) on the product detail page (PDP). A PDP may have several destinations, such as for features, banner, and spare parts. These destinations are labeled with letters: "a", "b", "c", etc. It is up to the theme developer as to where to put the snippet for each destination. For example, the "a" destination (for features) may follow the product description.  The "b" destination (for banners) may appear below the "Add to Cart" button. The "c" destination (for spare parts) may appear in a page section called "Spare Parts".
* ```handles, tags, collections, vendors, product types``` are all ways to designate which pages the HTML should appear on. For example, the call might list several handles and several tags. The HTML would appear on all the pages with those handles, as well as all pages that were tagged any one of the listed tags.
* ```base_url``` tells where to find all the ```html, styles, and images``` files that follow and which are to be embedded on the Shopify pages

#### Synchronization for smart handling of tags, etc.
As noted above, the API call allows the use of handles, tags, collections, vendors, and product types to indicate which PDPs should show particular FastLand content. This is straightforward for handles, because the app simply looks up the handle/destination in the FastLand database. If found, the app embeds the content on that PDP at that destination. But it gets trickier for tags, collections, vendors, and product types. It would be impossibly slow for the app to have to check whether there is a match for every tag, etc. for every destination on every PDP. Page load times would take forever.

Instead, the app runs a synchronization process to solve this problem. Every few hours, the app updates the FastLand database with the destination/handle for each FastLand page. Each time the sync process runs, it steps through each FastLand page that has been posted to that store. It queries the Shopify database to obtain the list of handles for each tag, collection, vendor, and product type for that FastLand page. It then updates the FastLand database with the handles for that FastLand page. On PDP load, only a single call is required to identify the FastLand page that should appear for each destination on that page, resulting in excellent performance.

### Frontend Functionality
The app frontend has four tabs.

#### Upload tab
The store owner uses this tab to upload Excel files that are used for the FastLand page specifications. The app first validates the files to make sure they are structured properly and that named handles, tags, etc. are found in the Shopify database. The app then performs minor transformations to the files and uploads them to FastLand Publisher, which uses the specifications to build the FastLand pages. (provide link here for validation and transformation specifications)

#### Sync tab
This allows  the user to specify the times that the sync process should run each day. It also provides a button to manually trigger the synchronization process.

#### Themes tab
This allows the store owner to manage which themes should be updated with the FastLand installation.  

#### Settings tab
This provides the "Handles Report". The report shows which FastLand cell sets have been assigned to which handles.
